"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[765],{4765:(e,t,s)=>{s.r(t),s.d(t,{default:()=>y});var a=s(7437),r=s(2265),l=s(8030);let o=(0,l.Z)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),c=(0,l.Z)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]),i=(0,l.Z)("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]),n=(0,l.Z)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);var d=s(6884),m=s(495),h=s(6013),u=s(3102),x=s(816);function g(e){let{onEmojiSelect:t,selectedEmoji:s}=e;return(0,a.jsxs)(h.Zb,{className:"emoji-picker absolute bottom-20 right-4 w-[320px] p-4 shadow-lg bg-white rounded-lg border z-50",children:[(0,a.jsx)("div",{className:"mb-2 pb-2 border-b",children:(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-500",children:"Emojis"})}),(0,a.jsx)("div",{className:"h-[200px] overflow-y-auto",children:(0,a.jsx)("div",{className:"grid grid-cols-8 gap-1",children:["\uD83D\uDE00","\uD83D\uDE03","\uD83D\uDE04","\uD83D\uDE01","\uD83D\uDE05","\uD83D\uDE02","\uD83E\uDD23","\uD83D\uDE0A","\uD83D\uDE07","\uD83D\uDE42","\uD83D\uDE43","\uD83D\uDE09","\uD83D\uDE0C","\uD83D\uDE0D","\uD83E\uDD70","\uD83D\uDE18","\uD83D\uDE17","\uD83D\uDE19","\uD83D\uDE1A","\uD83D\uDE0B","\uD83D\uDE1B","\uD83D\uDE1D","\uD83D\uDE1C","\uD83E\uDD2A","\uD83E\uDD28","\uD83E\uDDD0","\uD83E\uDD13","\uD83D\uDE0E","\uD83E\uDD78","\uD83E\uDD29","\uD83E\uDD73","\uD83D\uDE0F","\uD83D\uDE12","\uD83D\uDE1E","\uD83D\uDE14","\uD83D\uDE1F","\uD83D\uDE15","\uD83D\uDE41","☹️","\uD83D\uDE23","\uD83D\uDE16","\uD83D\uDE2B","\uD83D\uDE29","\uD83E\uDD7A","\uD83D\uDE22","\uD83D\uDE2D","\uD83D\uDE24","\uD83D\uDE20","\uD83D\uDC4B","\uD83E\uDD1A","✋","\uD83D\uDD90️","\uD83D\uDC4C","\uD83E\uDD0C","\uD83E\uDD0F","✌️","\uD83E\uDD1E","\uD83E\uDEF0","\uD83E\uDD1F","\uD83E\uDD18","\uD83E\uDD19","\uD83D\uDC48","\uD83D\uDC49","\uD83D\uDC4D","\uD83D\uDC4E","\uD83D\uDC4A","\uD83E\uDD1B","\uD83E\uDD1C","\uD83D\uDC4F","\uD83D\uDE4C","\uD83D\uDC50","\uD83E\uDD32","\uD83E\uDD1D","\uD83D\uDE4F","✍️","\uD83D\uDCAA","\uD83E\uDDBE","\uD83E\uDEC2","\uD83E\uDDD1","\uD83D\uDC76","\uD83C\uDF3A","\uD83C\uDF38","\uD83D\uDC90","\uD83C\uDF37","\uD83C\uDF39","\uD83C\uDF3B","\uD83C\uDF3C","\uD83C\uDF31","\uD83E\uDEB4","\uD83C\uDF32","\uD83C\uDF33","\uD83C\uDF34","\uD83C\uDF40","\uD83C\uDF41","\uD83D\uDC36","\uD83D\uDC31","\uD83D\uDC2D","\uD83D\uDC39","\uD83D\uDC30","\uD83E\uDD8A","\uD83D\uDC3B","\uD83D\uDC3C","\uD83D\uDC28","\uD83D\uDC2F","\uD83E\uDD81","\uD83D\uDC2E","\uD83D\uDC37","\uD83D\uDC38","\uD83D\uDC35","\uD83D\uDC14","\uD83E\uDD84","\uD83E\uDD8B","\uD83C\uDF4E","\uD83C\uDF50","\uD83C\uDF4A","\uD83C\uDF4B","\uD83C\uDF4C","\uD83C\uDF49","\uD83C\uDF47","\uD83C\uDF53","\uD83E\uDED0","\uD83C\uDF52","\uD83E\uDD5D","\uD83C\uDF45","\uD83E\uDD51","\uD83E\uDD66","\uD83E\uDD68","\uD83C\uDF69","\uD83C\uDF6A","\uD83C\uDF82","\uD83C\uDF70","\uD83E\uDDC1","\uD83E\uDD67","\uD83C\uDF6B","\uD83C\uDF6D","\uD83C\uDF61","☕","\uD83E\uDDC3","\uD83E\uDD64","\uD83E\uDDCB","\uD83C\uDF75","\uD83C\uDF76","\uD83E\uDD5B","\uD83C\uDF7C","⚽","\uD83C\uDFC0","\uD83C\uDFC8","⚾","\uD83C\uDFBE","\uD83C\uDFD0","\uD83C\uDFC9","\uD83C\uDFB1","\uD83C\uDFAE","\uD83C\uDFB2","♟️","\uD83C\uDFAD","\uD83C\uDFA8","\uD83C\uDFAC","\uD83C\uDFA4","\uD83C\uDFA7","\uD83C\uDFB5","\uD83C\uDFB6","\uD83C\uDFB9","\uD83E\uDE97","\uD83C\uDFB8","\uD83C\uDFBA","\uD83D\uDCF1","\uD83D\uDCBB","⌚","\uD83D\uDCF7","\uD83D\uDCA1","\uD83D\uDD0B","\uD83D\uDCDA","✏️","\uD83D\uDCCD","\uD83C\uDF88","❤️","\uD83E\uDDE1","\uD83D\uDC9B","\uD83D\uDC9A","\uD83D\uDC99","\uD83D\uDC9C","\uD83E\uDD0E","\uD83D\uDDA4","\uD83E\uDD0D","\uD83D\uDCAF","✨","⭐","\uD83C\uDF1F","\uD83D\uDCAB","\uD83C\uDF08","☀️","\uD83C\uDF24️","⛅","\uD83C\uDF25️","☁️","\uD83C\uDF26️","⛈️","\uD83C\uDF27️","\uD83D\uDCA7","\uD83D\uDCA6","\uD83C\uDF0A","\uD83C\uDFAF","\uD83D\uDD2E","\uD83C\uDFAA","\uD83C\uDFA0","\uD83C\uDFA1","\uD83C\uDFA2"].map(e=>(0,a.jsx)(m.z,{variant:"ghost",size:"sm",onClick:()=>t(e),className:"hover:bg-gray-100 p-1 h-8 w-8 ".concat(s===e?"bg-gray-200":""),children:(0,a.jsx)("span",{className:"text-lg",children:e})},e))})})]})}var p=s(6127);let f=(0,l.Z)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);var b=s(7776);let y=e=>{let{roomId:t,username:s}=e,[l,y]=(0,r.useState)(""),{messages:j,sendMessage:v,loading:N,loadingMore:w,error:k,hasMore:S,loadMoreMessages:z}=function(e){let[t,s]=(0,r.useState)([]),[a,l]=(0,r.useState)(!0),[o,c]=(0,r.useState)(!1),[i,n]=(0,r.useState)(null),[d,m]=(0,r.useState)(!0),[h,u]=(0,r.useState)(0),x=(0,r.useRef)(0);(0,r.useEffect)(()=>{g(0)},[e]);let g=async t=>{try{0===t?l(!0):c(!0);let a=await fetch("/api/room-messages/".concat(e,"?page=").concat(t));if(!a.ok)throw Error("Failed to fetch messages");let r=await a.json();r.messages&&(s(e=>0===t?r.messages:[...r.messages,...e].filter((e,t,s)=>t===s.findIndex(t=>t.id===e.id))),m(r.hasMore),u(r.currentPage))}catch(e){console.error("Error loading messages:",e),n("Failed to load messages")}finally{l(!1),c(!1)}},p=async e=>{d&&!o&&(x.current=e.scrollHeight-e.scrollTop,await g(h+1))};return(0,r.useEffect)(()=>{if(!a){let t=new EventSource("/api/chat/stream?roomId=".concat(e));return t.onmessage=e=>{let t=JSON.parse(e.data);s(e=>[...e,t])},t.onerror=()=>{n("Connection error"),t.close()},()=>{t.close()}}},[e,a]),{messages:t,sendMessage:(0,r.useCallback)(async(t,s)=>{try{let a={roomId:e,message:t,sender:s,timestamp:new Date};if(!(await fetch("/api/chat/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).ok)throw Error("Failed to send message")}catch(e){console.error("Error sending message:",e),n("Failed to send message")}},[e]),loading:a,loadingMore:o,error:i,hasMore:d,loadMoreMessages:p,restoreScrollPosition:e=>{if(x.current){let t=e.scrollHeight-x.current;e.scrollTop=t}}}}(t),E=s||localStorage.getItem("chatUsername")||"Anonymous",C=(0,r.useRef)(null),T=(0,r.useRef)(null),[Z,I]=(0,r.useState)(!1),[M,D]=(0,r.useState)(!1),H=(0,r.useCallback)(()=>{let e=T.current;if(!e)return;let t=.25*e.scrollHeight;e.scrollTop<t&&S&&!w&&z(e),e.scrollHeight-e.scrollTop-e.clientHeight<100?I(!1):I(!0)},[S,w,z]);(0,r.useEffect)(()=>{!Z&&T.current&&T.current.scrollTo({top:T.current.scrollHeight,behavior:"smooth"})},[j,Z]),(0,r.useEffect)(()=>{let e;let t=T.current;if(t){let s=()=>{e||(e=setTimeout(()=>{H(),e=void 0},150))};return t.addEventListener("scroll",s),()=>{t.removeEventListener("scroll",s),e&&clearTimeout(e)}}},[H]),(0,r.useEffect)(()=>{s&&localStorage.setItem("chatUsername",s)},[s]);let L=async e=>{e.preventDefault(),l.trim()&&(await v(l,E),y(""),I(!1),T.current&&T.current.scrollTo({top:T.current.scrollHeight,behavior:"smooth"}))};return(0,r.useEffect)(()=>{let e=e=>{let t=e.target,s=document.querySelector(".emoji-picker"),a=document.querySelector(".emoji-button");!s||s.contains(t)||(null==a?void 0:a.contains(t))||D(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 p-0 md:p-0 flex flex-col",children:[(0,a.jsx)("div",{className:"fixed md:top-10 w-screen z-10 pt-0 mb-0",children:(0,a.jsx)(h.Zb,{className:"shadow-lg bg-white/95 backdrop-blur-sm",children:(0,a.jsxs)(h.Ol,{className:"flex flex-row items-center justify-between border-b pb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(h.ll,{className:"text-2xl font-bold text-black",children:"Chat Room"}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["ID: ",t]})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)(m.z,{variant:"outline",size:"sm",onClick:()=>{navigator.clipboard.writeText(t),b.A.success("Room ID copied to clipboard")},className:"hover:bg-blue-50 hover:border-blue-300 transition-all duration-300",children:[(0,a.jsx)(d.Z,{className:"mr-2 h-4 w-4"})," Copy ID"]}),(0,a.jsxs)(m.z,{variant:"outline",size:"sm",onClick:()=>{localStorage.removeItem("chatRoomId"),localStorage.removeItem("chatUsername"),window.location.href="/chat"},className:"text-red-600 hover:bg-red-50 hover:border-red-300 transition-all duration-300",children:[(0,a.jsx)(o,{className:"mr-2 h-4 w-4"})," Leave"]})]})]})})}),(0,a.jsx)("div",{className:"flex-1 flex flex-col",style:{height:"calc(100vh - 140px)"},children:(0,a.jsx)(h.Zb,{className:"flex-1 flex flex-col  transition-all duration-300    mt-[4.4rem]",children:(0,a.jsxs)(h.aY,{ref:T,className:"flex-1 overflow-y-auto space-y-3 p-6 relative scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-transparent",onScroll:H,children:[w&&(0,a.jsx)("div",{className:"text-center py-2",children:(0,a.jsx)(x.a,{size:"sm",text:"Loading previous messages..."})}),N&&0===j.length?(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)(x.a,{size:"lg",text:"Loading messages..."})}):k?(0,a.jsxs)("div",{className:"flex items-center justify-center h-full text-red-500",children:[(0,a.jsx)(p.Z,{className:"h-5 w-5 mr-2"}),k]}):0===j.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-gray-500 space-y-2",children:[(0,a.jsx)(f,{className:"h-12 w-12 opacity-50"}),(0,a.jsx)("p",{children:"No messages yet. Start the conversation!"})]}):(0,a.jsxs)(a.Fragment,{children:[j.map((e,t)=>(0,a.jsx)("div",{className:"flex flex-col ".concat(e.sender===E?"items-end":"items-start"),children:(0,a.jsxs)("div",{className:"p-3 rounded-lg max-w-[80%] shadow-sm ".concat(e.sender===E?"bg-gradient-to-r from-blue-500 to-blue-600 text-white":"bg-gray-100"),children:[(0,a.jsx)("div",{className:"font-bold text-sm ".concat(e.sender===E?"text-blue-50":"text-gray-600"),children:e.sender}),(0,a.jsx)("div",{className:"mt-1 text-sm",children:e.message}),(0,a.jsxs)("div",{className:"text-xs mt-1 ".concat(e.sender===E?"text-blue-100":"text-gray-500"),children:[new Date(e.timestamp).toLocaleDateString()," •"," ",new Date(e.timestamp).toLocaleTimeString()]})]})},e.id||t)),(0,a.jsx)("div",{ref:C})]}),Z&&(0,a.jsx)(m.z,{variant:"outline",size:"icon",className:"fixed bottom-28 right-8 z-[999] rounded-full shadow-lg bg-white hover:bg-blue-50",onClick:()=>{T.current&&(T.current.scrollTo({top:T.current.scrollHeight,behavior:"smooth"}),I(!1))},children:(0,a.jsx)(c,{className:"h-4 w-4 text-black"})})]})})}),(0,a.jsxs)("div",{className:"sticky md:bottom-0 md:pt-12 bottom-12 bg-white border-t",children:[(0,a.jsx)("form",{onSubmit:L,className:"p-4 bg-gray-50/50 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"container flex items-center space-x-3",children:[(0,a.jsx)(u.I,{type:"text",autoFocus:!0,value:l,onChange:e=>{y(e.target.value)},placeholder:"Type your message...",className:"flex-1 border-2 focus:ring-2 focus:ring-blue-200 transition-all duration-300"}),(0,a.jsx)(m.z,{variant:"ghost",size:"icon",onClick:e=>{e.preventDefault(),D(!M)},className:"emoji-button hover:bg-blue-50 transition-all duration-300 ".concat(M?"text-blue-600":""),children:(0,a.jsx)(i,{className:"w-5 h-5"})}),(0,a.jsx)(m.z,{type:"submit",disabled:!l.trim()||N,className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:opacity-90 text-white transition-all duration-300",children:N?(0,a.jsx)(x.a,{size:"sm",className:"text-white"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n,{className:"mr-2 h-4 w-4"})," Send"]})})]})}),M&&(0,a.jsx)("div",{className:"emoji-picker absolute bottom-full right-4 z-50",children:(0,a.jsx)(g,{onEmojiSelect:e=>{y(t=>t+e)}})})]})]})}},6884:(e,t,s)=>{s.d(t,{Z:()=>a});let a=(0,s(8030).Z)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]])},6127:(e,t,s)=>{s.d(t,{Z:()=>a});let a=(0,s(8030).Z)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])}}]);