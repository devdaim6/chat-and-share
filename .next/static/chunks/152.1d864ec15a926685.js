"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[152],{5152:(e,s,t)=>{t.r(s),t.d(s,{default:()=>g});var a=t(7437),r=t(2265),l=t(8030);let c=(0,l.Z)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),o=(0,l.Z)("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]),n=(0,l.Z)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);var i=t(6884),m=t(495),d=t(6013),x=t(3102),h=t(816);function u(e){let{onEmojiSelect:s,selectedEmoji:t}=e;return(0,a.jsxs)(d.Zb,{className:"emoji-picker absolute bottom-20 right-4 w-[320px] p-4 shadow-lg bg-white rounded-lg border z-50",children:[(0,a.jsx)("div",{className:"mb-2 pb-2 border-b",children:(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-500",children:"Emojis"})}),(0,a.jsx)("div",{className:"h-[200px] overflow-y-auto",children:(0,a.jsx)("div",{className:"grid grid-cols-8 gap-1",children:["\uD83D\uDE00","\uD83D\uDE03","\uD83D\uDE04","\uD83D\uDE01","\uD83D\uDE05","\uD83D\uDE02","\uD83E\uDD23","\uD83D\uDE0A","\uD83D\uDE07","\uD83D\uDE42","\uD83D\uDE43","\uD83D\uDE09","\uD83D\uDE0C","\uD83D\uDE0D","\uD83E\uDD70","\uD83D\uDE18","\uD83D\uDE17","\uD83D\uDE19","\uD83D\uDE1A","\uD83D\uDE0B","\uD83D\uDE1B","\uD83D\uDE1D","\uD83D\uDE1C","\uD83E\uDD2A","\uD83E\uDD28","\uD83E\uDDD0","\uD83E\uDD13","\uD83D\uDE0E","\uD83E\uDD78","\uD83E\uDD29","\uD83E\uDD73","\uD83D\uDE0F","\uD83D\uDE12","\uD83D\uDE1E","\uD83D\uDE14","\uD83D\uDE1F","\uD83D\uDE15","\uD83D\uDE41","☹️","\uD83D\uDE23","\uD83D\uDE16","\uD83D\uDE2B","\uD83D\uDE29","\uD83E\uDD7A","\uD83D\uDE22","\uD83D\uDE2D","\uD83D\uDE24","\uD83D\uDE20","\uD83D\uDC4B","\uD83E\uDD1A","✋","\uD83D\uDD90️","\uD83D\uDC4C","\uD83E\uDD0C","\uD83E\uDD0F","✌️","\uD83E\uDD1E","\uD83E\uDEF0","\uD83E\uDD1F","\uD83E\uDD18","\uD83E\uDD19","\uD83D\uDC48","\uD83D\uDC49","\uD83D\uDC4D","\uD83D\uDC4E","\uD83D\uDC4A","\uD83E\uDD1B","\uD83E\uDD1C","\uD83D\uDC4F","\uD83D\uDE4C","\uD83D\uDC50","\uD83E\uDD32","\uD83E\uDD1D","\uD83D\uDE4F","✍️","\uD83D\uDCAA","\uD83E\uDDBE","\uD83E\uDEC2","\uD83E\uDDD1","\uD83D\uDC76","\uD83C\uDF3A","\uD83C\uDF38","\uD83D\uDC90","\uD83C\uDF37","\uD83C\uDF39","\uD83C\uDF3B","\uD83C\uDF3C","\uD83C\uDF31","\uD83E\uDEB4","\uD83C\uDF32","\uD83C\uDF33","\uD83C\uDF34","\uD83C\uDF40","\uD83C\uDF41","\uD83D\uDC36","\uD83D\uDC31","\uD83D\uDC2D","\uD83D\uDC39","\uD83D\uDC30","\uD83E\uDD8A","\uD83D\uDC3B","\uD83D\uDC3C","\uD83D\uDC28","\uD83D\uDC2F","\uD83E\uDD81","\uD83D\uDC2E","\uD83D\uDC37","\uD83D\uDC38","\uD83D\uDC35","\uD83D\uDC14","\uD83E\uDD84","\uD83E\uDD8B","\uD83C\uDF4E","\uD83C\uDF50","\uD83C\uDF4A","\uD83C\uDF4B","\uD83C\uDF4C","\uD83C\uDF49","\uD83C\uDF47","\uD83C\uDF53","\uD83E\uDED0","\uD83C\uDF52","\uD83E\uDD5D","\uD83C\uDF45","\uD83E\uDD51","\uD83E\uDD66","\uD83E\uDD68","\uD83C\uDF69","\uD83C\uDF6A","\uD83C\uDF82","\uD83C\uDF70","\uD83E\uDDC1","\uD83E\uDD67","\uD83C\uDF6B","\uD83C\uDF6D","\uD83C\uDF61","☕","\uD83E\uDDC3","\uD83E\uDD64","\uD83E\uDDCB","\uD83C\uDF75","\uD83C\uDF76","\uD83E\uDD5B","\uD83C\uDF7C","⚽","\uD83C\uDFC0","\uD83C\uDFC8","⚾","\uD83C\uDFBE","\uD83C\uDFD0","\uD83C\uDFC9","\uD83C\uDFB1","\uD83C\uDFAE","\uD83C\uDFB2","♟️","\uD83C\uDFAD","\uD83C\uDFA8","\uD83C\uDFAC","\uD83C\uDFA4","\uD83C\uDFA7","\uD83C\uDFB5","\uD83C\uDFB6","\uD83C\uDFB9","\uD83E\uDE97","\uD83C\uDFB8","\uD83C\uDFBA","\uD83D\uDCF1","\uD83D\uDCBB","⌚","\uD83D\uDCF7","\uD83D\uDCA1","\uD83D\uDD0B","\uD83D\uDCDA","✏️","\uD83D\uDCCD","\uD83C\uDF88","❤️","\uD83E\uDDE1","\uD83D\uDC9B","\uD83D\uDC9A","\uD83D\uDC99","\uD83D\uDC9C","\uD83E\uDD0E","\uD83D\uDDA4","\uD83E\uDD0D","\uD83D\uDCAF","✨","⭐","\uD83C\uDF1F","\uD83D\uDCAB","\uD83C\uDF08","☀️","\uD83C\uDF24️","⛅","\uD83C\uDF25️","☁️","\uD83C\uDF26️","⛈️","\uD83C\uDF27️","\uD83D\uDCA7","\uD83D\uDCA6","\uD83C\uDF0A","\uD83C\uDFAF","\uD83D\uDD2E","\uD83C\uDFAA","\uD83C\uDFA0","\uD83C\uDFA1","\uD83C\uDFA2"].map(e=>(0,a.jsx)(m.z,{variant:"ghost",size:"sm",onClick:()=>s(e),className:"hover:bg-gray-100 p-1 h-8 w-8 ".concat(t===e?"bg-gray-200":""),children:(0,a.jsx)("span",{className:"text-lg",children:e})},e))})})]})}let g=e=>{let{roomId:s,username:t}=e,[l,g]=(0,r.useState)(""),{messages:f,sendMessage:y,loading:p,loadingMore:j,error:v,hasMore:w,loadMoreMessages:N,restoreScrollPosition:b}=function(e){let[s,t]=(0,r.useState)([]),[a,l]=(0,r.useState)(!0),[c,o]=(0,r.useState)(!1),[n,i]=(0,r.useState)(null),[m,d]=(0,r.useState)(!0),[x,h]=(0,r.useState)(0),u=(0,r.useRef)(0);(0,r.useEffect)(()=>{g(0)},[e]);let g=async s=>{try{0===s?l(!0):o(!0);let a=await fetch("/api/room-messages/".concat(e,"?page=").concat(s));if(!a.ok)throw Error("Failed to fetch messages");let r=await a.json();r.messages&&(t(e=>0===s?r.messages:[...r.messages,...e].filter((e,s,t)=>s===t.findIndex(s=>s.id===e.id))),d(r.hasMore),h(r.currentPage))}catch(e){console.error("Error loading messages:",e),i("Failed to load messages")}finally{l(!1),o(!1)}},f=async e=>{m&&!c&&(u.current=e.scrollHeight-e.scrollTop,await g(x+1))};return(0,r.useEffect)(()=>{if(!a){let s=new EventSource("/api/chat/stream?roomId=".concat(e));return s.onmessage=e=>{let s=JSON.parse(e.data);t(e=>[...e,s])},s.onerror=()=>{i("Connection error"),s.close()},()=>{s.close()}}},[e,a]),{messages:s,sendMessage:(0,r.useCallback)(async(s,t)=>{try{let a={roomId:e,message:s,sender:t,timestamp:new Date};if(!(await fetch("/api/chat/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).ok)throw Error("Failed to send message")}catch(e){console.error("Error sending message:",e),i("Failed to send message")}},[e]),loading:a,loadingMore:c,error:n,hasMore:m,loadMoreMessages:f,restoreScrollPosition:e=>{if(u.current){let s=e.scrollHeight-u.current;e.scrollTop=s}}}}(s),S=t||localStorage.getItem("chatUsername")||"Anonymous",k=(0,r.useRef)(null),E=(0,r.useRef)(null),[z,C]=(0,r.useState)(!0),[I,L]=(0,r.useState)(!1),T=(0,r.useCallback)(()=>{let e=E.current;e&&(0===e.scrollTop&&w&&!j&&N(e),C(e.scrollHeight-e.scrollTop-e.clientHeight<100))},[w,j,N]);(0,r.useEffect)(()=>{!j&&E.current&&b(E.current)},[f,j]),(0,r.useEffect)(()=>{if(z){var e;null===(e=k.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}},[f,z]),(0,r.useEffect)(()=>{let e=E.current;if(e)return e.addEventListener("scroll",T),()=>e.removeEventListener("scroll",T)},[T]),(0,r.useEffect)(()=>{t&&localStorage.setItem("chatUsername",t)},[t]);let Z=async e=>{e.preventDefault(),l.trim()&&(await y(l,S),g(""))};return(0,r.useEffect)(()=>{let e=e=>{let s=e.target,t=document.querySelector(".emoji-picker"),a=document.querySelector(".emoji-button");!t||t.contains(s)||(null==a?void 0:a.contains(s))||L(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,a.jsx)("div",{className:"min-h-screen bg-gray-100 p-8 flex flex-col",children:(0,a.jsxs)(d.Zb,{className:"flex-1 flex flex-col",children:[(0,a.jsxs)(d.Ol,{className:"flex flex-row items-center justify-between",children:[(0,a.jsxs)(d.ll,{children:["Room ID : ",s]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(m.z,{variant:"outline",size:"sm",onClick:()=>navigator.clipboard.writeText(s),children:[(0,a.jsx)(i.Z,{className:"mr-2 h-4 w-4"})," Copy Room ID"]}),(0,a.jsxs)(m.z,{variant:"destructive",size:"sm",onClick:()=>{localStorage.removeItem("chatRoomId"),localStorage.removeItem("chatUsername"),window.location.href="/chat"},children:[(0,a.jsx)(c,{className:"mr-2 h-4 w-4"})," Leave Room"]})]})]}),(0,a.jsxs)(d.aY,{ref:E,className:"flex-1 overflow-y-auto space-y-2 p-4 relative",style:{maxHeight:"calc(100vh - 300px)"},onScroll:T,children:[j&&(0,a.jsx)("div",{className:"text-center py-2",children:(0,a.jsx)(h.a,{size:"sm",text:"Loading previous messages..."})}),p&&0===f.length?(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)(h.a,{size:"lg",text:"Loading messages..."})}):v?(0,a.jsx)("div",{className:"text-red-500 text-center",children:v}):0===f.length?(0,a.jsx)("div",{className:"text-gray-500 text-center",children:"No messages yet"}):(0,a.jsxs)(a.Fragment,{children:[f.map((e,s)=>(0,a.jsxs)("div",{className:"p-2 rounded-lg max-w-[80%] ".concat(e.sender===S?"bg-blue-100 self-end ml-auto":"bg-gray-100 mr-auto"),children:[(0,a.jsx)("div",{className:"font-bold text-sm",children:e.sender}),(0,a.jsx)("div",{children:e.message}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:[new Date(e.timestamp).toLocaleDateString()," :"," ",new Date(e.timestamp).toLocaleTimeString()]})]},e.id||s)),(0,a.jsx)("div",{ref:k})]})]}),(0,a.jsx)("form",{onSubmit:Z,className:"p-4 border-t flex flex-col space-y-2",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(x.I,{type:"text",value:l,onChange:e=>{g(e.target.value)},placeholder:"Type your message...",className:"flex-1"}),(0,a.jsx)(m.z,{variant:"ghost",size:"icon",onClick:()=>{L(!I)},className:"emoji-button ".concat(I?"text-primary-foreground":""),children:(0,a.jsx)(o,{className:"w-5 h-5"})}),(0,a.jsxs)(m.z,{type:"submit",disabled:!l.trim()||p,children:[(0,a.jsx)(n,{className:"mr-2 h-4 w-4"})," Send"]})]})}),I&&(0,a.jsx)("div",{className:"emoji-picker",children:(0,a.jsx)(u,{onEmojiSelect:e=>{g(s=>s+e)}})})]})})}},6884:(e,s,t)=>{t.d(s,{Z:()=>a});let a=(0,t(8030).Z)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]])}}]);