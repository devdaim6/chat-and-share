(()=>{var e={};e.id=30,e.ids=[30],e.modules={20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},79348:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30412:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},13673:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>l,routeModule:()=>m,serverHooks:()=>g,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>c});var s={};r.r(s),r.d(s,{GET:()=>u});var a=r(88797),o=r(10042),n=r(58492),i=r(59540),d=r(62085);async function u(e,{params:t}){try{await (0,d.uD)();let{roomId:r}=await t,s=new URL(e.url),a=parseInt(s.searchParams.get("page")||"0"),o=await d.WK.findOne({roomId:r});if(!o)return i.NextResponse.json({messages:[]});let n=o.messages.length,u=Math.ceil(n/10),m=Math.max(0,n-(a+1)*10),p=Math.max(0,n-10*a),c=o.messages.slice(m,p).map(e=>({id:e._id.toString(),roomId:r,message:e.message,sender:e.sender,timestamp:e.timestamp.getTime()}));return i.NextResponse.json({messages:c,currentPage:a,totalPages:u,hasMore:a<u-1})}catch(e){return console.error("Message retrieval error:",e),i.NextResponse.json({error:"Failed to retrieve messages"},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/room-messages/[roomId]/route",pathname:"/api/room-messages/[roomId]",filename:"route",bundlePath:"app/api/room-messages/[roomId]/route"},resolvedPagePath:"C:\\Users\\Administrator\\Desktop\\CHAt\\chat-and-share\\app\\api\\room-messages\\[roomId]\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:p,workUnitAsyncStorage:c,serverHooks:g}=m;function l(){return(0,n.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:c})}},78031:()=>{},35303:()=>{},62085:(e,t,r)=>{"use strict";r.d(t,{WK:()=>u,Ee:()=>d,uD:()=>o});let s=require("mongoose");var a=r.n(s);let o=async()=>{try{0===a().connection.readyState&&(await a().connect(process.env.MONGODB_URI),console.log("Connected to MongoDB"))}catch(e){throw console.error("MongoDB connection error:",e),e}},n=new(a()).Schema({imageId:{type:String,required:!0,unique:!0},message:{type:String},imageData:{type:String,required:!0},scheduledForDeletion:{type:Boolean,default:!1},createdAt:{type:Date,default:Date.now}}),i=new(a()).Schema({roomId:{type:String,required:!0,unique:!0},messages:[{sender:{type:String,required:!0},message:{type:String,required:!0},timestamp:{type:Date,default:Date.now}}],createdAt:{type:Date,default:Date.now,expires:"24h"}}),d=a().models.Image||a().model("Image",n),u=a().models.ChatRoom||a().model("ChatRoom",i)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[492,661],()=>r(13673));module.exports=s})();