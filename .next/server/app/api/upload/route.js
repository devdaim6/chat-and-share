(()=>{var e={};e.id=998,e.ids=[998],e.modules={20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},79348:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30412:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},84770:e=>{"use strict";e.exports=require("crypto")},11732:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>v,routeModule:()=>y,serverHooks:()=>q,workAsyncStorage:()=>D,workUnitAsyncStorage:()=>x});var a={};r.r(a),r.d(a,{POST:()=>w});var o=r(88797),n=r(10042),s=r(58492),i=r(59540),u=r(84770);let d={randomUUID:u.randomUUID},p=new Uint8Array(256),l=p.length,c=[];for(let e=0;e<256;++e)c.push((e+256).toString(16).slice(1));let m=function(e,t,r){if(d.randomUUID&&!t&&!e)return d.randomUUID();let a=(e=e||{}).random||(e.rng||function(){return l>p.length-16&&((0,u.randomFillSync)(p),l=0),p.slice(l,l+=16)})();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=a[e];return t}return function(e,t=0){return(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase()}(a)},g=require("sharp");var f=r.n(g),h=r(62085);async function w(e){try{await (0,h.uD)();let t=await e.formData(),r=t.get("image"),a=t.get("message");if(!r)return i.NextResponse.json({error:"No file uploaded"},{status:400});let o=await r.arrayBuffer(),n=Buffer.from(o),s=await f()(n).resize({width:1200,height:1200,fit:"inside",withoutEnlargement:!0}).webp({quality:80}).toBuffer(),u=m(),d=new h.Ee({imageId:u,message:a||"",imageData:`data:image/webp;base64,${s.toString("base64")}`});return await d.save(),i.NextResponse.json({imageId:u,message:"Image uploaded successfully"})}catch(e){return console.error("Upload error:",e),i.NextResponse.json({error:"Upload failed"},{status:500})}}let y=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/upload/route",pathname:"/api/upload",filename:"route",bundlePath:"app/api/upload/route"},resolvedPagePath:"C:\\Users\\Administrator\\Desktop\\CHAt\\chat-and-share\\app\\api\\upload\\route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:D,workUnitAsyncStorage:x,serverHooks:q}=y;function v(){return(0,s.patchFetch)({workAsyncStorage:D,workUnitAsyncStorage:x})}},78031:()=>{},35303:()=>{},62085:(e,t,r)=>{"use strict";r.d(t,{WK:()=>d,Ee:()=>u,uD:()=>n});let a=require("mongoose");var o=r.n(a);let n=async()=>{try{0===o().connection.readyState&&(await o().connect(process.env.MONGODB_URI),console.log("Connected to MongoDB"))}catch(e){throw console.error("MongoDB connection error:",e),e}},s=new(o()).Schema({imageId:{type:String,required:!0,unique:!0},message:{type:String},imageData:{type:String,required:!0},scheduledForDeletion:{type:Boolean,default:!1},createdAt:{type:Date,default:Date.now}}),i=new(o()).Schema({roomId:{type:String,required:!0,unique:!0},messages:[{sender:{type:String,required:!0},message:{type:String,required:!0},timestamp:{type:Date,default:Date.now}}],createdAt:{type:Date,default:Date.now}}),u=o().models.Image||o().model("Image",s),d=o().models.ChatRoom||o().model("ChatRoom",i)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[492,661],()=>r(11732));module.exports=a})();